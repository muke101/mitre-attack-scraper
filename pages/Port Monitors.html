<ac:layout>
<ac:layout-section ac:type="two_right_sidebar">
<ac:layout-cell>
<div class="wiki-content" id="main-content">
<div class="contentLayout2">
<div class="columnLayout two-right-sidebar" data-layout="two-right-sidebar">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p>A port monitor can be set through the   API call to set a DLL to be loaded at startup.  This DLL can be located in C:\Windows\System32 and will be loaded by the print spooler service, spoolsv.exe, on boot. The spoolsv.exe process also runs under SYSTEM level permissions.  Alternatively, an arbitrary DLL can be loaded if permissions allow writing a fully-qualified pathname for that DLL to HKLM\SYSTEM\CurrentControlSet\Control\Print\Monitors.  The Registry key contains entries for the following: Local PortStandard TCP/IP PortUSB MonitorWSD Port Adversaries can use this technique to load malicious code at startup that will persist on system reboot and execute as SYSTEM. </p><h2 id="MitreRecommendations"><strong>Mitre Recommendations</strong></h2><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd">Mitigation</td><td class="confluenceTd"><p>Identify and block potentially malicious software that may persist in this manner by using whitelisting  tools capable of monitoring DLL loads by processes running under SYSTEM permissions.</p></td></tr><tr><td class="confluenceTd"><p>Detection</p></td><td class="confluenceTd"><p style="text-align: left;">Monitor process API calls to  .Monitor DLLs that are loaded by spoolsv.exe for DLLs that are abnormal.New DLLs written to the System32 directory that do not correlate with known good software or patching may be suspicious.Monitor Registry writes to HKLM\SYSTEM\CurrentControlSet\Control\Print\Monitors.Run the Autoruns utility, which checks for this Registry key as a persistence mechanism </p></td></tr></tbody></table></div></div>
</div>
</div></div></div></ac:layout-cell>
<ac:layout-cell>
<div class="cell aside" data-type="aside">
<div class="innerCell">
<h1 id="SCORE:#/5" style="text-align: left;"><strong>SCORE: #/5</strong></h1><p><strong>ID</strong>: <a href="https://attack.mitre.org/techniques/T1013">T1013</a></p><p><strong>Tactic</strong>: Persistence, Privilege Escalation</p><p><strong>Platform</strong>: Windows</p><p><strong>Permissions Required</strong>: Administrator, SYSTEM</p><p><strong>Effective Permissions</strong>: SYSTEM</p><p><strong>Data Sources</strong>: File monitoring, API monitoring, DLL monitoring, Windows Registry, Process monitoring</p><p><br/><p><br/></p></p></div>
</div>
</ac:layout-cell></ac:layout-section>


<ac:layout-section ac:type="single">
<ac:layout-cell>
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 id="VISA" style="text-align: center;"><em style="letter-spacing: -0.01em;"><strong>VISA</strong></em></h1><hr/><p><br/></p></div>
</div>
</div>
</ac:layout-cell>
</ac:layout-section>
<ac:layout-section ac:type="two_equal">
<ac:layout-cell>
<div class="columnLayout two-equal" data-layout="two-equal">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h2 id="Mitigation"><strong>MitigationÂ </strong></h2><p></p><p><br/></p></div>
</div>
</div></ac:layout-cell>
<ac:layout-cell>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h2 id="Detection"><strong>Detection</strong></h2><p></p></div></div></ac:layout-cell></ac:layout-section>



<ac:layout-section ac:type="single">
<div class="columnLayout single" data-layout="single">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<p><br/></p><p>
<p></p></p></div>
</div>
</div>
</ac:layout-section>




</ac:layout>
